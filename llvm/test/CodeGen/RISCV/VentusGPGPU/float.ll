; NOTE: Assertions have been autogenerated by utils/update_llc_test_checks.py
; RUN: llc -mtriple=riscv32 -mcpu=ventus-gpgpu -verify-machineinstrs < %s \
; RUN:   | FileCheck -check-prefix=VENTUS %s

define float @foo_fadd(float noundef %a, float noundef %b) {
; VENTUS-LABEL: foo_fadd:
; VENTUS:       # %bb.0: # %entry
; VENTUS-NEXT:    vfadd.vv v0, v0, v1
; VENTUS-NEXT:    ret
entry:
  %add = fadd float %a, %b
  ret float %add
}

define float @foo_fmul(float noundef %a, float noundef %b) {
; VENTUS-LABEL: foo_fmul:
; VENTUS:       # %bb.0: # %entry
; VENTUS-NEXT:    vfmul.vv v0, v0, v1
; VENTUS-NEXT:    ret
entry:
  %mul = fmul float %a, %b
  ret float %mul
}

define float @foo_fdiv(float noundef %a, float noundef %b) {
; VENTUS-LABEL: foo_fdiv:
; VENTUS:       # %bb.0: # %entry
; VENTUS-NEXT:    vfdiv.vv v0, v0, v1
; VENTUS-NEXT:    ret
entry:
  %div = fdiv float %a, %b
  ret float %div
}

define float @foo_constant(float noundef %a) {
; VENTUS-LABEL: foo_constant:
; VENTUS:       # %bb.0: # %entry
; VENTUS-NEXT:    lui a0, %hi(.LCPI3_0)
; VENTUS-NEXT:    lw a0, %lo(.LCPI3_0)(a0)
; VENTUS-NEXT:    vmv.s.x v1, a0
; VENTUS-NEXT:    vfmul.vv v0, v0, v1
; VENTUS-NEXT:    ret
entry:
  %mul = fmul float %a, 1.25
  ret float %mul
}

define float @sqrt_f32(float %a) {
; VENTUS-LABEL: sqrt_f32:
; VENTUS:       # %bb.0:
; VENTUS-NEXT:    vfsqrt.v v0, v0
; VENTUS-NEXT:    ret
  %b = call float @llvm.sqrt.f32(float %a)
  ret float %b
}

define dso_local float @feq(float noundef %a, float noundef %b) local_unnamed_addr  {
; VENTUS-LABEL: feq:
; VENTUS:       # %bb.0: # %entry
; VENTUS-NEXT:    vmv.s.x v2, zero
; VENTUS-NEXT:    vmfeq.vv v0, v0, v1
; VENTUS-NEXT:    lui a0, %hi(.LCPI5_0)
; VENTUS-NEXT:    addi a0, a0, %lo(.LCPI5_0)
; VENTUS-NEXT:    vbne v0, v2, .LBB5_2
; VENTUS-NEXT:  # %bb.1: # %entry
; VENTUS-NEXT:    vmv.s.x v0, a0
; VENTUS-NEXT:    vjoin .LBB5_3
; VENTUS-NEXT:  .LBB5_2: # %entry
; VENTUS-NEXT:    addi a0, a0, 4
; VENTUS-NEXT:    vmv.s.x v0, a0
; VENTUS-NEXT:    vjoin .LBB5_3
; VENTUS-NEXT:  .LBB5_3: # %entry
; VENTUS-NEXT:    vmv.s.x v1, zero
; VENTUS-NEXT:    vmv.x.s a0, v0
; VENTUS-NEXT:    vluxei32.v v0, (a0), v1
; VENTUS-NEXT:    ret
entry:
  %cmp = fcmp oeq float %a, %b
  %conv = uitofp i1 %cmp to float
  ret float %conv
}

; Function Attrs: mustprogress nofree norecurse nosync nounwind willreturn memory(none)
define dso_local float @fneq(float noundef %a, float noundef %b) local_unnamed_addr  {
; VENTUS-LABEL: fneq:
; VENTUS:       # %bb.0: # %entry
; VENTUS-NEXT:    vmv.s.x v2, zero
; VENTUS-NEXT:    vmfne.vv v0, v0, v1
; VENTUS-NEXT:    lui a0, %hi(.LCPI6_0)
; VENTUS-NEXT:    addi a0, a0, %lo(.LCPI6_0)
; VENTUS-NEXT:    vbne v0, v2, .LBB6_2
; VENTUS-NEXT:  # %bb.1: # %entry
; VENTUS-NEXT:    vmv.s.x v0, a0
; VENTUS-NEXT:    vjoin .LBB6_3
; VENTUS-NEXT:  .LBB6_2: # %entry
; VENTUS-NEXT:    addi a0, a0, 4
; VENTUS-NEXT:    vmv.s.x v0, a0
; VENTUS-NEXT:    vjoin .LBB6_3
; VENTUS-NEXT:  .LBB6_3: # %entry
; VENTUS-NEXT:    vmv.s.x v1, zero
; VENTUS-NEXT:    vmv.x.s a0, v0
; VENTUS-NEXT:    vluxei32.v v0, (a0), v1
; VENTUS-NEXT:    ret
entry:
  %cmp = fcmp une float %a, %b
  %conv = uitofp i1 %cmp to float
  ret float %conv
}

; Function Attrs: mustprogress nofree norecurse nosync nounwind willreturn memory(none)
define dso_local float @flt(float noundef %a, float noundef %b) local_unnamed_addr  {
; VENTUS-LABEL: flt:
; VENTUS:       # %bb.0: # %entry
; VENTUS-NEXT:    vmv.s.x v2, zero
; VENTUS-NEXT:    vmflt.vv v0, v0, v1
; VENTUS-NEXT:    lui a0, %hi(.LCPI7_0)
; VENTUS-NEXT:    addi a0, a0, %lo(.LCPI7_0)
; VENTUS-NEXT:    vbne v0, v2, .LBB7_2
; VENTUS-NEXT:  # %bb.1: # %entry
; VENTUS-NEXT:    vmv.s.x v0, a0
; VENTUS-NEXT:    vjoin .LBB7_3
; VENTUS-NEXT:  .LBB7_2: # %entry
; VENTUS-NEXT:    addi a0, a0, 4
; VENTUS-NEXT:    vmv.s.x v0, a0
; VENTUS-NEXT:    vjoin .LBB7_3
; VENTUS-NEXT:  .LBB7_3: # %entry
; VENTUS-NEXT:    vmv.s.x v1, zero
; VENTUS-NEXT:    vmv.x.s a0, v0
; VENTUS-NEXT:    vluxei32.v v0, (a0), v1
; VENTUS-NEXT:    ret
entry:
  %cmp = fcmp olt float %a, %b
  %conv = uitofp i1 %cmp to float
  ret float %conv
}

; Function Attrs: mustprogress nofree norecurse nosync nounwind willreturn memory(none)
define dso_local float @fle(float noundef %a, float noundef %b) local_unnamed_addr  {
; VENTUS-LABEL: fle:
; VENTUS:       # %bb.0: # %entry
; VENTUS-NEXT:    vmv.s.x v2, zero
; VENTUS-NEXT:    vmfle.vv v0, v0, v1
; VENTUS-NEXT:    lui a0, %hi(.LCPI8_0)
; VENTUS-NEXT:    addi a0, a0, %lo(.LCPI8_0)
; VENTUS-NEXT:    vbne v0, v2, .LBB8_2
; VENTUS-NEXT:  # %bb.1: # %entry
; VENTUS-NEXT:    vmv.s.x v0, a0
; VENTUS-NEXT:    vjoin .LBB8_3
; VENTUS-NEXT:  .LBB8_2: # %entry
; VENTUS-NEXT:    addi a0, a0, 4
; VENTUS-NEXT:    vmv.s.x v0, a0
; VENTUS-NEXT:    vjoin .LBB8_3
; VENTUS-NEXT:  .LBB8_3: # %entry
; VENTUS-NEXT:    vmv.s.x v1, zero
; VENTUS-NEXT:    vmv.x.s a0, v0
; VENTUS-NEXT:    vluxei32.v v0, (a0), v1
; VENTUS-NEXT:    ret
entry:
  %cmp = fcmp ole float %a, %b
  %conv = uitofp i1 %cmp to float
  ret float %conv
}

; Function Attrs: noinline nounwind optnone
define dso_local float @fgt(float noundef %a)  {
; VENTUS-LABEL: fgt:
; VENTUS:       # %bb.0: # %entry
; VENTUS-NEXT:    lui a0, %hi(.LCPI9_0)
; VENTUS-NEXT:    lw a0, %lo(.LCPI9_0)(a0)
; VENTUS-NEXT:    vmv.s.x v1, zero
; VENTUS-NEXT:    vmfgt.vf v0, v0, a0
; VENTUS-NEXT:    lui a0, %hi(.LCPI9_1)
; VENTUS-NEXT:    addi a0, a0, %lo(.LCPI9_1)
; VENTUS-NEXT:    vbne v0, v1, .LBB9_2
; VENTUS-NEXT:  # %bb.1: # %entry
; VENTUS-NEXT:    vmv.s.x v0, a0
; VENTUS-NEXT:    vjoin .LBB9_3
; VENTUS-NEXT:  .LBB9_2: # %entry
; VENTUS-NEXT:    addi a0, a0, 4
; VENTUS-NEXT:    vmv.s.x v0, a0
; VENTUS-NEXT:    vjoin .LBB9_3
; VENTUS-NEXT:  .LBB9_3: # %entry
; VENTUS-NEXT:    vmv.s.x v1, zero
; VENTUS-NEXT:    vmv.x.s a0, v0
; VENTUS-NEXT:    vluxei32.v v0, (a0), v1
; VENTUS-NEXT:    ret
entry:
  %b = alloca float, align 4, addrspace(5)
  store float 0x3FF3333340000000, ptr addrspace(5) %b, align 4
  %0 = load float, ptr addrspace(5) %b, align 4
  %cmp = fcmp ogt float %a, %0
  %cond = select i1 %cmp, i32 1, i32 0
  %conv = sitofp i32 %cond to float
  ret float %conv
}

; Function Attrs: noinline nounwind optnone
define dso_local float @fge(float noundef %a)  {
; VENTUS-LABEL: fge:
; VENTUS:       # %bb.0: # %entry
; VENTUS-NEXT:    lui a0, %hi(.LCPI10_0)
; VENTUS-NEXT:    lw a0, %lo(.LCPI10_0)(a0)
; VENTUS-NEXT:    vmv.s.x v1, zero
; VENTUS-NEXT:    vmfge.vf v0, v0, a0
; VENTUS-NEXT:    lui a0, %hi(.LCPI10_1)
; VENTUS-NEXT:    addi a0, a0, %lo(.LCPI10_1)
; VENTUS-NEXT:    vbne v0, v1, .LBB10_2
; VENTUS-NEXT:  # %bb.1: # %entry
; VENTUS-NEXT:    vmv.s.x v0, a0
; VENTUS-NEXT:    vjoin .LBB10_3
; VENTUS-NEXT:  .LBB10_2: # %entry
; VENTUS-NEXT:    addi a0, a0, 4
; VENTUS-NEXT:    vmv.s.x v0, a0
; VENTUS-NEXT:    vjoin .LBB10_3
; VENTUS-NEXT:  .LBB10_3: # %entry
; VENTUS-NEXT:    vmv.s.x v1, zero
; VENTUS-NEXT:    vmv.x.s a0, v0
; VENTUS-NEXT:    vluxei32.v v0, (a0), v1
; VENTUS-NEXT:    ret
entry:
  %b = alloca float, align 4, addrspace(5)
  store float 0x3FF3333340000000, ptr addrspace(5) %b, align 4
  %0 = load float, ptr addrspace(5) %b, align 4
  %cmp = fcmp oge float %a, %0
  %cond = select i1 %cmp, i32 1, i32 0
  %conv = sitofp i32 %cond to float
  ret float %conv
}

; Function Attrs: mustprogress nofree norecurse nosync nounwind willreturn memory(none)
define dso_local noundef float @fmadd(float noundef %a, float noundef %b, float noundef %c) local_unnamed_addr  {
; VENTUS-LABEL: fmadd:
; VENTUS:       # %bb.0: # %entry
; VENTUS-NEXT:    vfmadd.vv v1, v0, v2
; VENTUS-NEXT:    vadd.vx v0, v1, zero
; VENTUS-NEXT:    ret
entry:
  %mul = fmul float %a, %b
  %add = fadd float %mul, %c
  ret float %add
}

; Function Attrs: mustprogress nofree nosync nounwind willreturn memory(none)
define dso_local noundef float @fmadd_llvm(float noundef %a, float noundef %b, float noundef %c) local_unnamed_addr  {
; VENTUS-LABEL: fmadd_llvm:
; VENTUS:       # %bb.0: # %entry
; VENTUS-NEXT:    vfmadd.vv v1, v0, v2
; VENTUS-NEXT:    vadd.vx v0, v1, zero
; VENTUS-NEXT:    ret
entry:
  %0 = tail call float @llvm.fmuladd.f32(float %a, float %b, float %c)
  ret float %0
}

; Function Attrs: mustprogress nofree norecurse nosync nounwind willreturn memory(none)
define dso_local noundef float @fmsub(float noundef %a, float noundef %b, float noundef %c) local_unnamed_addr  {
; VENTUS-LABEL: fmsub:
; VENTUS:       # %bb.0: # %entry
; VENTUS-NEXT:    vfmsub.vv v1, v0, v2
; VENTUS-NEXT:    vadd.vx v0, v1, zero
; VENTUS-NEXT:    ret
entry:
  %mul = fmul float %a, %b
  %sub = fsub float %mul, %c
  ret float %sub
}

; Function Attrs: mustprogress nofree norecurse nosync nounwind willreturn memory(none) vscale_range(1,2048)
define dso_local i32 @fcvt_x_f(float noundef %a) local_unnamed_addr  {
; VENTUS-LABEL: fcvt_x_f:
; VENTUS:       # %bb.0: # %entry
; VENTUS-NEXT:    vfcvt.x.f.v v0, v0
; VENTUS-NEXT:    ret
entry:
  %conv = fptosi float %a to i32
  ret i32 %conv
}

; Function Attrs: mustprogress nofree norecurse nosync nounwind willreturn memory(none) vscale_range(1,2048)
define dso_local i32 @fcvtu_xu_f(float noundef %a) local_unnamed_addr  {
; VENTUS-LABEL: fcvtu_xu_f:
; VENTUS:       # %bb.0: # %entry
; VENTUS-NEXT:    vfcvt.xu.f.v v0, v0
; VENTUS-NEXT:    ret
entry:
  %conv = fptoui float %a to i32
  ret i32 %conv
}

; Function Attrs: mustprogress nofree norecurse nosync nounwind willreturn memory(none) vscale_range(1,2048)
define dso_local float @fcvt_f_x(i32 noundef %a) local_unnamed_addr  {
; VENTUS-LABEL: fcvt_f_x:
; VENTUS:       # %bb.0: # %entry
; VENTUS-NEXT:    vfcvt.f.x.v v0, v0
; VENTUS-NEXT:    ret
entry:
  %conv = sitofp i32 %a to float
  ret float %conv
}

; Function Attrs: mustprogress nofree norecurse nosync nounwind willreturn memory(none) vscale_range(1,2048)
define dso_local float @fcvt_f_xu(i32 noundef %a) local_unnamed_addr  {
; VENTUS-LABEL: fcvt_f_xu:
; VENTUS:       # %bb.0: # %entry
; VENTUS-NEXT:    vfcvt.f.xu.v v0, v0
; VENTUS-NEXT:    ret
entry:
  %conv = uitofp i32 %a to float
  ret float %conv
}

; Function Attrs: mustprogress nofree norecurse nosync nounwind willreturn memory(none)
define dso_local float @fmadd_v(float noundef %a, float noundef %b, float noundef %c) local_unnamed_addr  {
; VENTUS-LABEL: fmadd_v:
; VENTUS:       # %bb.0: # %entry
; VENTUS-NEXT:    vfmadd.vv v1, v0, v2
; VENTUS-NEXT:    vadd.vx v0, v1, zero
; VENTUS-NEXT:    ret
entry:
  %mul = fmul float %a, %b
  %add = fadd float %mul, %c
  ret float %add
}

; Function Attrs: mustprogress nofree nosync nounwind willreturn memory(none)
define dso_local float @fmadd_f(float noundef %a, float noundef %b, float noundef %c) local_unnamed_addr  {
; VENTUS-LABEL: fmadd_f:
; VENTUS:       # %bb.0: # %entry
; VENTUS-NEXT:    lui a0, %hi(.LCPI19_0)
; VENTUS-NEXT:    lw a0, %lo(.LCPI19_0)(a0)
; VENTUS-NEXT:    vmv.s.x v0, a0
; VENTUS-NEXT:    vfmadd.vv v0, v1, v2
; VENTUS-NEXT:    ret
entry:
  %0 = tail call float @llvm.fmuladd.f32(float %b, float 0x3FF3333340000000, float %c)
  ret float %0
}

; Function Attrs: mustprogress nofree norecurse nosync nounwind willreturn memory(none)
define dso_local float @fnmadd_v(float noundef %a, float noundef %b, float noundef %c) local_unnamed_addr  {
; VENTUS-LABEL: fnmadd_v:
; VENTUS:       # %bb.0: # %entry
; VENTUS-NEXT:    vfnmadd.vv v1, v0, v2
; VENTUS-NEXT:    vadd.vx v0, v1, zero
; VENTUS-NEXT:    ret
entry:
  %0 = fneg float %a
  %fneg = fmul float %0, %b
  %sub = fsub float %fneg, %c
  ret float %sub
}

; Function Attrs: mustprogress nofree norecurse nosync nounwind willreturn memory(none)
define dso_local float @fnmadd_f(float noundef %a, float noundef %b, float noundef %c) local_unnamed_addr  {
; VENTUS-LABEL: fnmadd_f:
; VENTUS:       # %bb.0: # %entry
; VENTUS-NEXT:    lui a0, %hi(.LCPI21_0)
; VENTUS-NEXT:    lw a0, %lo(.LCPI21_0)(a0)
; VENTUS-NEXT:    vmv.s.x v0, a0
; VENTUS-NEXT:    vfmsub.vv v0, v1, v2
; VENTUS-NEXT:    ret
entry:
  %fneg = fmul float %b, 0xBFF3333340000000
  %sub = fsub float %fneg, %c
  ret float %sub
}

; Function Attrs: mustprogress nofree norecurse nosync nounwind willreturn memory(none)
define dso_local float @fmsub_v(float noundef %a, float noundef %b, float noundef %c) local_unnamed_addr  {
; VENTUS-LABEL: fmsub_v:
; VENTUS:       # %bb.0: # %entry
; VENTUS-NEXT:    vfmsub.vv v1, v0, v2
; VENTUS-NEXT:    vadd.vx v0, v1, zero
; VENTUS-NEXT:    ret
entry:
  %mul = fmul float %a, %b
  %sub = fsub float %mul, %c
  ret float %sub
}

; Function Attrs: mustprogress nofree norecurse nosync nounwind willreturn memory(none)
define dso_local float @fmsub_f(float noundef %a, float noundef %b) local_unnamed_addr  {
; VENTUS-LABEL: fmsub_f:
; VENTUS:       # %bb.0: # %entry
; VENTUS-NEXT:    lui a0, %hi(.LCPI23_0)
; VENTUS-NEXT:    lw a0, %lo(.LCPI23_0)(a0)
; VENTUS-NEXT:    vmv.s.x v2, a0
; VENTUS-NEXT:    vfmsub.vv v2, v0, v1
; VENTUS-NEXT:    vadd.vx v0, v2, zero
; VENTUS-NEXT:    ret
entry:
  %mul = fmul float %a, 0x3FF3333340000000
  %sub = fsub float %mul, %b
  ret float %sub
}

; Function Attrs: mustprogress nofree norecurse nosync nounwind willreturn memory(none)
define dso_local float @fnmsub_v(float noundef %a, float noundef %b, float noundef %c) local_unnamed_addr  {
; VENTUS-LABEL: fnmsub_v:
; VENTUS:       # %bb.0: # %entry
; VENTUS-NEXT:    vfnmsub.vv v1, v0, v2
; VENTUS-NEXT:    vadd.vx v0, v1, zero
; VENTUS-NEXT:    ret
entry:
  %0 = fmul float %a, %b
  %add = fsub float %c, %0
  ret float %add
}

; Function Attrs: mustprogress nofree norecurse nosync nounwind willreturn memory(none)
define dso_local float @fnmsub_f(float noundef %a, float noundef %b, float noundef %c) local_unnamed_addr  {
; VENTUS-LABEL: fnmsub_f:
; VENTUS:       # %bb.0: # %entry
; VENTUS-NEXT:    lui a0, %hi(.LCPI25_0)
; VENTUS-NEXT:    lw a0, %lo(.LCPI25_0)(a0)
; VENTUS-NEXT:    vmv.s.x v0, a0
; VENTUS-NEXT:    vfmadd.vv v0, v1, v2
; VENTUS-NEXT:    ret
entry:
  %fneg = fmul float %b, 0x3FF3333340000000
  %0 = fsub float %c, %fneg
  ret float %0
}

; Function Attrs: mustprogress nocallback nofree nosync nounwind speculatable willreturn memory(none)
define float @fsgnj_v(float %a, float %b) nounwind {
; VENTUS-LABEL: fsgnj_v:
; VENTUS:       # %bb.0:
; VENTUS-NEXT:    vfsgnj.vv v0, v0, v1
; VENTUS-NEXT:    ret
  %1 = call float @llvm.copysign.f32(float %a, float %b)
  ret float %1
}

define float @fsgnjn_v(float %a, float %b) nounwind {
; VENTUS-LABEL: fsgnjn_v:
; VENTUS:       # %bb.0:
; VENTUS-NEXT:    vfadd.vv v1, v0, v1
; VENTUS-NEXT:    vfsgnjn.vv v0, v0, v1
; VENTUS-NEXT:    ret
  %1 = fadd float %a, %b
  %2 = fneg float %1
  %3 = call float @llvm.copysign.f32(float %a, float %2)
  ret float %3
}

define float @fsgnjn_v_1(float %a) nounwind {
; VENTUS-LABEL: fsgnjn_v_1:
; VENTUS:       # %bb.0:
; VENTUS-NEXT:    vfsgnjn.vv v0, v0, v0
; VENTUS-NEXT:    ret
  %1 = fneg float %a
  ret float %1
}

define float @fsgnjnx_v(float %a) nounwind {
; VENTUS-LABEL: fsgnjnx_v:
; VENTUS:       # %bb.0:
; VENTUS-NEXT:    vfsgnjx.vv v0, v0, v0
; VENTUS-NEXT:    ret
  %1 = call float @llvm.fabs.f32(float %a)
  ret float %1
}

define i32 @fcvt_rtz_x_f_v(float %a) nounwind {
; VENTUS-LABEL: fcvt_rtz_x_f_v:
; VENTUS:       # %bb.0:
; VENTUS-NEXT:    vfcvt.rtz.x.f.v v0, v0
; VENTUS-NEXT:    ret
  %1 = call float @llvm.trunc.f32(float %a)
  %conv = fptosi float %1 to i32
  ret i32 %conv
}

define i32 @fcvt_rtz_xu_f_v(float %x) {
; VENTUS-LABEL: fcvt_rtz_xu_f_v:
; VENTUS:       # %bb.0:
; VENTUS-NEXT:    vfcvt.rtz.xu.f.v v0, v0
; VENTUS-NEXT:    ret
  %a = call float @llvm.trunc.f32(float %x)
  %b = fptoui float %a to i32
  ret i32 %b
}

declare float @llvm.sqrt.f32(float %Val)
declare float @llvm.fmuladd.f32(float, float, float)
declare float @llvm.trunc.f32(float)
declare float @llvm.fabs.f32(float  %Val)
declare float @llvm.copysign.f32(float %a, float %b)
